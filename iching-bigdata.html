<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ˜“ç» = å¤ä»£å¤§æ•°æ®ç³»ç»Ÿ | ç»“æ„åŒ–åˆ†æä¸çŠ¶æ€æ¨¡æ‹Ÿ</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #21262d;
      --border: #30363d;
      --text: #e6edf3;
      --dim: #8b949e;
      --blue: #58a6ff;
      --green: #3fb950;
      --yellow: #d29922;
      --purple: #a371f7;
      --red: #f85149;
      --cyan: #39c5cf;
      --orange: #f0883e;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font: 14px/1.6 'SF Mono', Consolas, monospace;
      min-height: 100vh;
    }

    .header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h1 {
      font-size: 18px;
      color: var(--cyan);
    }
    .header .meta {
      font-size: 12px;
      color: var(--dim);
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 1200px) {
      .grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 800px) {
      .grid, .grid-2 { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
    }
    .card.full { grid-column: 1 / -1; }
    .card h2 {
      font-size: 13px;
      color: var(--cyan);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card h3 {
      font-size: 12px;
      color: var(--yellow);
      margin: 14px 0 8px;
    }

    /* ä»£ç å— */
    .code {
      background: var(--bg);
      border-radius: 6px;
      padding: 12px;
      font-size: 11px;
      overflow-x: auto;
      white-space: pre;
      line-height: 1.5;
    }
    .code .comment { color: var(--dim); }
    .code .keyword { color: var(--purple); }
    .code .string { color: var(--green); }
    .code .number { color: var(--orange); }
    .code .function { color: var(--blue); }

    /* è¡¨æ ¼ */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin: 10px 0;
    }
    th, td {
      padding: 8px;
      border: 1px solid var(--border);
      text-align: left;
    }
    th { background: var(--surface2); color: var(--cyan); }

    /* çŠ¶æ€è½¬æ¢çŸ©é˜µ */
    .matrix {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 1px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      font-size: 9px;
    }
    .matrix .cell {
      background: var(--surface);
      padding: 4px;
      text-align: center;
      min-width: 32px;
    }
    .matrix .cell.header {
      background: var(--surface2);
      color: var(--cyan);
      font-weight: 600;
    }
    .matrix .cell.high { background: rgba(63,185,80,0.3); }
    .matrix .cell.medium { background: rgba(210,153,34,0.2); }
    .matrix .cell.low { background: var(--surface); }

    /* æ¨¡æ‹Ÿå™¨ */
    .simulator {
      background: var(--bg);
      border-radius: 8px;
      padding: 16px;
    }
    .sim-controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    button {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font: inherit;
      font-size: 12px;
    }
    button:hover { border-color: var(--cyan); }
    button.primary { background: var(--cyan); color: #000; border-color: var(--cyan); }

    input, select {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 6px;
      font: inherit;
      font-size: 12px;
    }

    .sim-output {
      background: var(--surface);
      border-radius: 6px;
      padding: 12px;
      font-size: 11px;
      max-height: 300px;
      overflow-y: auto;
    }
    .sim-output .line { margin-bottom: 4px; }
    .sim-output .state { color: var(--cyan); }
    .sim-output .prob { color: var(--yellow); }
    .sim-output .arrow { color: var(--dim); }

    /* å›¾è¡¨åŒºåŸŸ */
    .chart-container {
      background: var(--bg);
      border-radius: 8px;
      padding: 12px;
      height: 200px;
    }
    canvas { width: 100% !important; height: 100% !important; }

    /* æŒ‡æ ‡å¡ç‰‡ */
    .metric {
      background: var(--surface2);
      border-radius: 6px;
      padding: 12px;
      text-align: center;
    }
    .metric .value {
      font-size: 24px;
      font-weight: 700;
      color: var(--cyan);
    }
    .metric .label {
      font-size: 10px;
      color: var(--dim);
      margin-top: 4px;
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 12px 0;
    }

    /* æ ‡ç­¾ */
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      margin-right: 4px;
    }
    .tag.blue { background: rgba(88,166,255,0.2); color: var(--blue); }
    .tag.green { background: rgba(63,185,80,0.2); color: var(--green); }
    .tag.yellow { background: rgba(210,153,34,0.2); color: var(--yellow); }
    .tag.purple { background: rgba(163,113,247,0.2); color: var(--purple); }

    .note {
      background: rgba(88,166,255,0.1);
      border-left: 3px solid var(--blue);
      padding: 10px 14px;
      margin: 12px 0;
      font-size: 12px;
      border-radius: 0 6px 6px 0;
    }

    .insight {
      background: rgba(163,113,247,0.1);
      border-left: 3px solid var(--purple);
      padding: 10px 14px;
      margin: 12px 0;
      font-size: 12px;
      border-radius: 0 6px 6px 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>æ˜“ç» = å¤ä»£å¤§æ•°æ®ç³»ç»Ÿ</h1>
    <div class="meta">ç»“æ„åŒ–åˆ†ææ¡†æ¶ | çŠ¶æ€ç©ºé—´æ¨¡å‹ | é©¬å°”å¯å¤«æ¨¡æ‹Ÿ</div>
  </div>

  <div class="container">
    <!-- æ ¸å¿ƒæ´å¯Ÿ -->
    <div class="card full">
      <h2>ğŸ’¡ æ ¸å¿ƒè§†è§’è½¬æ¢</h2>
      <div class="grid">
        <div>
          <h3>ä¼ ç»Ÿè§†è§’</h3>
          <p style="color:var(--dim); font-size:12px;">å åœã€é¢„æµ‹ã€ç¥ç§˜ä¸»ä¹‰</p>
        </div>
        <div>
          <h3>ç»“æ„åŒ–åˆ†æè§†è§’</h3>
          <p style="color:var(--green); font-size:12px;">æƒ…å¢ƒåˆ†ç±»å™¨ã€å†³ç­–æ¡†æ¶ã€æ£€æŸ¥æ¸…å•</p>
        </div>
        <div>
          <h3>å¤§æ•°æ®ç³»ç»Ÿè§†è§’</h3>
          <p style="color:var(--cyan); font-size:12px;">çŠ¶æ€ç©ºé—´ã€è½¬æ¢çŸ©é˜µã€è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ</p>
        </div>
      </div>
    </div>

    <!-- æ•°æ®ç»“æ„æ˜ å°„ -->
    <div class="card full">
      <h2>ğŸ“Š æ˜“ç» â†’ ç°ä»£æ•°æ®ç»“æ„æ˜ å°„</h2>

      <table>
        <tr>
          <th>æ˜“ç»æ¦‚å¿µ</th>
          <th>æ•°æ®ç»“æ„</th>
          <th>æ•°å­¦è¡¨ç¤º</th>
          <th>ç°ä»£åº”ç”¨</th>
        </tr>
        <tr>
          <td>é˜´é˜³ (0/1)</td>
          <td>äºŒè¿›åˆ¶ä½ (bit)</td>
          <td>b âˆˆ {0, 1}</td>
          <td>å¸ƒå°”é€»è¾‘ã€å¼€å…³çŠ¶æ€</td>
        </tr>
        <tr>
          <td>å…«å¦ (8ç§)</td>
          <td>3-bitå‘é‡</td>
          <td>v âˆˆ {0,1}Â³, |S| = 8</td>
          <td>8åˆ†ç±»å™¨ã€RGBé¢œè‰²ç©ºé—´</td>
        </tr>
        <tr>
          <td>å…­åå››å¦ (64ç§)</td>
          <td>6-bitå‘é‡ / çŠ¶æ€ç©ºé—´</td>
          <td>s âˆˆ {0,1}â¶, |S| = 64</td>
          <td>64ç±»æƒ…å¢ƒã€DNAå¯†ç å­</td>
        </tr>
        <tr>
          <td>å˜çˆ»</td>
          <td>çŠ¶æ€è½¬æ¢ / XORæ“ä½œ</td>
          <td>s' = s âŠ• mask</td>
          <td>é©¬å°”å¯å¤«é“¾ã€çŠ¶æ€æœº</td>
        </tr>
        <tr>
          <td>å¦è¾/çˆ»è¾</td>
          <td>çŠ¶æ€-åŠ¨ä½œæ˜ å°„è¡¨</td>
          <td>f: S â†’ A (ç­–ç•¥å‡½æ•°)</td>
          <td>ä¸“å®¶ç³»ç»Ÿã€å†³ç­–è¡¨</td>
        </tr>
        <tr>
          <td>å…«å®«</td>
          <td>èšç±»/åˆ†ç»„</td>
          <td>8ä¸ªç­‰ä»·ç±»</td>
          <td>K-Meansèšç±» (k=8)</td>
        </tr>
        <tr>
          <td>ç­®å¦è¿‡ç¨‹</td>
          <td>é‡‡æ ·ç®—æ³•</td>
          <td>è’™ç‰¹å¡æ´›é‡‡æ ·</td>
          <td>MCMCã€éšæœºæ¨¡æ‹Ÿ</td>
        </tr>
        <tr>
          <td>æœ¬å¦â†’å˜å¦</td>
          <td>çŠ¶æ€è½¬ç§»</td>
          <td>P(s'|s) è½¬ç§»æ¦‚ç‡</td>
          <td>é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</td>
        </tr>
      </table>
    </div>

    <div class="grid-2">
      <!-- çŠ¶æ€ç©ºé—´å®šä¹‰ -->
      <div class="card">
        <h2>ğŸ”¢ çŠ¶æ€ç©ºé—´å½¢å¼åŒ–å®šä¹‰</h2>

        <div class="code">
<span class="comment">// æ˜“ç»çŠ¶æ€ç©ºé—´çš„å½¢å¼åŒ–å®šä¹‰</span>

<span class="keyword">class</span> <span class="function">IChingStateSpace</span> {
  <span class="comment">// çŠ¶æ€ç©ºé—´ S = {0,1}^6</span>
  states: <span class="number">64</span>  <span class="comment">// 2^6 = 64ç§çŠ¶æ€</span>

  <span class="comment">// çŠ¶æ€è¡¨ç¤º</span>
  <span class="function">encode</span>(ä¸Šå¦, ä¸‹å¦) â†’ 6-bit binary
  <span class="function">decode</span>(binary) â†’ (ä¸Šå¦, ä¸‹å¦)

  <span class="comment">// è½¬ç§»å‡½æ•° (å˜çˆ»)</span>
  <span class="function">transition</span>(state, mask) {
    <span class="keyword">return</span> state <span class="keyword">XOR</span> mask
  }

  <span class="comment">// é‚»å±…çŠ¶æ€ (æ±‰æ˜è·ç¦»=1)</span>
  <span class="function">neighbors</span>(state) {
    <span class="keyword">return</span> [state^1, state^2, state^4,
            state^8, state^16, state^32]
  }

  <span class="comment">// çŠ¶æ€ç‰¹å¾æå–</span>
  <span class="function">features</span>(state) {
    é˜³çˆ»æ•°: <span class="function">popcount</span>(~state & 0x3F)
    å¯¹ç§°æ€§: state == <span class="function">reverse</span>(state)
    ç¨³å®šæ€§: <span class="function">changeProb</span>(state)
  }
}
        </div>
      </div>

      <!-- è½¬ç§»æ¦‚ç‡çŸ©é˜µ -->
      <div class="card">
        <h2>ğŸ“ˆ çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</h2>

        <p style="font-size:11px; color:var(--dim); margin-bottom:10px;">
          å…«å¦ä¹‹é—´çš„å•æ­¥è½¬ç§»æ¦‚ç‡ï¼ˆåŸºäºå•çˆ»å˜æ¢ï¼‰
        </p>

        <div class="matrix" id="transitionMatrix">
          <!-- ç”±JSç”Ÿæˆ -->
        </div>

        <div class="note">
          <strong>é©¬å°”å¯å¤«æ€§è´¨ï¼š</strong>ä¸‹ä¸€çŠ¶æ€åªä¾èµ–å½“å‰çŠ¶æ€ï¼Œä¸å†å²æ— å…³ã€‚
          æ¯ä¸ªçŠ¶æ€æœ‰6ä¸ªç›´æ¥å¯è¾¾é‚»å±…ï¼ˆæ±‰æ˜è·ç¦»=1ï¼‰ã€‚
        </div>
      </div>
    </div>

    <!-- ä½œä¸ºåˆ†ç±»å™¨ -->
    <div class="card full">
      <h2>ğŸ·ï¸ æ˜“ç»ä½œä¸º64ç±»æƒ…å¢ƒåˆ†ç±»å™¨</h2>

      <div class="grid">
        <div>
          <h3>è¾“å…¥ç‰¹å¾æå–</h3>
          <div class="code" style="font-size:10px;">
<span class="comment">// ä»é—®é¢˜ä¸­æå–6ç»´ç‰¹å¾</span>
<span class="keyword">function</span> <span class="function">extractFeatures</span>(é—®é¢˜) {
  <span class="keyword">return</span> {
    D1: åŸºç¡€æ¡ä»¶ â†’ 0/1,  <span class="comment">// å…·å¤‡=0, ä¸è¶³=1</span>
    D2: å†…éƒ¨å› ç´  â†’ 0/1,  <span class="comment">// ä¼˜åŠ¿=0, åŠ£åŠ¿=1</span>
    D3: å˜åŒ–æ€åŠ¿ â†’ 0/1,  <span class="comment">// ç¨³å®š=0, åŠ¨è¡=1</span>
    D4: å¤–éƒ¨ç¯å¢ƒ â†’ 0/1,  <span class="comment">// æœ‰åˆ©=0, ä¸åˆ©=1</span>
    D5: æ ¸å¿ƒéœ€æ±‚ â†’ 0/1,  <span class="comment">// æ˜ç¡®=0, æ¨¡ç³Š=1</span>
    D6: æ—¶é—´å‹åŠ› â†’ 0/1   <span class="comment">// å……è£•=0, ç´§è¿«=1</span>
  }
}
          </div>
        </div>

        <div>
          <h3>çŠ¶æ€æ˜ å°„</h3>
          <div class="code" style="font-size:10px;">
<span class="comment">// ç‰¹å¾å‘é‡ â†’ å¦è±¡çŠ¶æ€</span>
<span class="keyword">function</span> <span class="function">classify</span>(features) {
  binary = features.D1 + features.D2*2
         + features.D3*4 + features.D4*8
         + features.D5*16 + features.D6*32

  <span class="keyword">return</span> HEXAGRAMS[binary]
  <span class="comment">// è¿”å›å¯¹åº”çš„å¦è±¡å’Œå»ºè®®</span>
}

<span class="comment">// ä¾‹ï¼š(0,0,0,0,0,0) â†’ ä¹¾å¦ (æœ€ä½³çŠ¶æ€)</span>
<span class="comment">// ä¾‹ï¼š(1,1,1,1,1,1) â†’ å¤å¦ (éœ€è¦ç­‰å¾…)</span>
          </div>
        </div>

        <div>
          <h3>è¾“å‡ºå»ºè®®</h3>
          <div class="code" style="font-size:10px;">
<span class="comment">// æ¯ä¸ªçŠ¶æ€å¯¹åº”çš„å†³ç­–å»ºè®®</span>
<span class="keyword">const</span> STRATEGY = {
  <span class="string">"000000"</span>: {  <span class="comment">// ä¹¾</span>
    action: <span class="string">"ç§¯æè¡ŒåŠ¨"</span>,
    risk: <span class="string">"ä½"</span>,
    timing: <span class="string">"ç«‹å³"</span>
  },
  <span class="string">"111111"</span>: {  <span class="comment">// å¤</span>
    action: <span class="string">"ç­‰å¾…æ—¶æœº"</span>,
    risk: <span class="string">"è¯„ä¼°ä¸­"</span>,
    timing: <span class="string">"å»¶è¿Ÿ"</span>
  },
  <span class="comment">// ... 64ç§ç­–ç•¥</span>
}
          </div>
        </div>
      </div>

      <div class="insight">
        <strong>æ´å¯Ÿï¼š</strong>æ˜“ç»æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>64ç±»å†³ç­–åˆ†ç±»å™¨</strong>ï¼Œå°†å¤æ‚çš„ç°å®æƒ…å¢ƒæ˜ å°„åˆ°64ç§é¢„å®šä¹‰çš„æ¨¡å¼ä¸­ï¼Œ
        æ¯ç§æ¨¡å¼é…æœ‰å†å²æ€»ç»“çš„æœ€ä½³å®è·µå»ºè®®ã€‚è¿™ä¸ç°ä»£çš„<strong>ä¸“å®¶ç³»ç»Ÿ</strong>å’Œ<strong>å†³ç­–æ”¯æŒç³»ç»Ÿ</strong>åŸç†ç›¸åŒã€‚
      </div>
    </div>

    <!-- è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ -->
    <div class="card full">
      <h2>ğŸ² é©¬å°”å¯å¤«é“¾è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿå™¨</h2>

      <div class="grid-2">
        <div>
          <div class="simulator">
            <h3>æ¨¡æ‹Ÿå‚æ•°</h3>
            <div class="sim-controls">
              <select id="startState">
                <option value="0">ä¹¾ (000000) - å…¨é˜³</option>
                <option value="63">å¤ (111111) - å…¨é˜´</option>
                <option value="42">æ—¢æµ (101010) - äº¤é”™</option>
                <option value="21">æœªæµ (010101) - äº¤é”™</option>
                <option value="random">éšæœºåˆå§‹çŠ¶æ€</option>
              </select>
              <input type="number" id="simSteps" value="100" min="10" max="10000" style="width:80px;">
              <span style="font-size:11px; color:var(--dim);">æ­¥æ•°</span>
            </div>

            <div class="sim-controls">
              <button class="primary" onclick="runMarkovSimulation()">è¿è¡Œæ¨¡æ‹Ÿ</button>
              <button onclick="runEnsemble()">é›†æˆæ¨¡æ‹Ÿ (1000æ¬¡)</button>
              <button onclick="analyzeStability()">ç¨³å®šæ€§åˆ†æ</button>
            </div>

            <div class="sim-output" id="simOutput">
              <div class="line" style="color:var(--dim);">ç‚¹å‡»è¿è¡Œæ¨¡æ‹Ÿ...</div>
            </div>
          </div>
        </div>

        <div>
          <h3>ç»Ÿè®¡åˆ†æ</h3>
          <div class="metrics-row">
            <div class="metric">
              <div class="value" id="metricVisited">-</div>
              <div class="label">è®¿é—®çŠ¶æ€æ•°</div>
            </div>
            <div class="metric">
              <div class="value" id="metricEntropy">-</div>
              <div class="label">ç†µ (bits)</div>
            </div>
            <div class="metric">
              <div class="value" id="metricYangRatio">-</div>
              <div class="label">å¹³å‡é˜³çˆ»ç‡</div>
            </div>
            <div class="metric">
              <div class="value" id="metricCycles">-</div>
              <div class="label">å‘¨æœŸæ£€æµ‹</div>
            </div>
          </div>

          <h3>çŠ¶æ€åˆ†å¸ƒ</h3>
          <div class="chart-container">
            <canvas id="distributionChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸ç°ä»£ç³»ç»Ÿå¯¹æ¯” -->
    <div class="card full">
      <h2>âš–ï¸ æ˜“ç» vs ç°ä»£å¤§æ•°æ®ç³»ç»Ÿ</h2>

      <table>
        <tr>
          <th>ç‰¹æ€§</th>
          <th>æ˜“ç»ç³»ç»Ÿ</th>
          <th>ç°ä»£ç­‰ä»·ç‰©</th>
          <th>è¯„ä»·</th>
        </tr>
        <tr>
          <td>çŠ¶æ€ç©ºé—´å¤§å°</td>
          <td>64 (2â¶)</td>
          <td>MLæ¨¡å‹: 10Â³~10Â¹Â²</td>
          <td><span class="tag yellow">æœ‰é™ä½†è¶³å¤Ÿå†³ç­–åœºæ™¯</span></td>
        </tr>
        <tr>
          <td>ç‰¹å¾ç»´åº¦</td>
          <td>6ç»´ (å…­çˆ»)</td>
          <td>æ·±åº¦å­¦ä¹ : 10Â³~10â¶ç»´</td>
          <td><span class="tag green">äººç±»å¯ç†è§£çš„ä½ç»´</span></td>
        </tr>
        <tr>
          <td>è®­ç»ƒæ•°æ®</td>
          <td>~3000å¹´äººç±»ç»éªŒ</td>
          <td>å¤§æ•°æ®: TB~PBçº§</td>
          <td><span class="tag purple">è´¨é‡é«˜ä½†æ•°é‡æœ‰é™</span></td>
        </tr>
        <tr>
          <td>å¯è§£é‡Šæ€§</td>
          <td>å®Œå…¨å¯è§£é‡Š</td>
          <td>ç¥ç»ç½‘ç»œ: é»‘ç®±</td>
          <td><span class="tag green">æ˜“ç»å®Œèƒœ</span></td>
        </tr>
        <tr>
          <td>æ³›åŒ–èƒ½åŠ›</td>
          <td>é«˜åº¦æŠ½è±¡ï¼Œæ³›åŒ–å¼º</td>
          <td>ä¾èµ–è®­ç»ƒåˆ†å¸ƒ</td>
          <td><span class="tag green">æ˜“ç»çš„æŠ½è±¡æ˜¯ä¼˜åŠ¿</span></td>
        </tr>
        <tr>
          <td>å®æ—¶æ€§</td>
          <td>O(1) æŸ¥è¡¨</td>
          <td>æ¨ç†å»¶è¿Ÿä¸å®š</td>
          <td><span class="tag green">æ˜“ç»æå¿«</span></td>
        </tr>
        <tr>
          <td>è®¡ç®—èµ„æº</td>
          <td>äººè„‘ / çº¸ç¬”</td>
          <td>GPUé›†ç¾¤</td>
          <td><span class="tag green">æ˜“ç»é›¶æˆæœ¬</span></td>
        </tr>
        <tr>
          <td>æ›´æ–°èƒ½åŠ›</td>
          <td>å›ºå®šï¼ˆé™¤éé‡æ–°è§£è¯»ï¼‰</td>
          <td>æŒç»­å­¦ä¹ </td>
          <td><span class="tag yellow">ç°ä»£ç³»ç»Ÿæ›´çµæ´»</span></td>
        </tr>
      </table>
    </div>

    <!-- ä½œä¸ºå†³ç­–æ ‘ -->
    <div class="card full">
      <h2>ğŸŒ³ æ˜“ç»ä½œä¸ºé¢„ç¼–è¯‘å†³ç­–æ ‘</h2>

      <div class="grid-2">
        <div>
          <div class="code">
<span class="comment">// æ˜“ç»å†³ç­–æ ‘çš„ä¼ªä»£ç è¡¨ç¤º</span>

<span class="keyword">function</span> <span class="function">iching_decision</span>(situation) {

  <span class="comment">// ç¬¬ä¸€å±‚ï¼šåŸºç¡€æ¡ä»¶ (åˆçˆ»)</span>
  <span class="keyword">if</span> (åŸºç¡€æ¡ä»¶å……è¶³) {
    node = <span class="number">0</span>  <span class="comment">// é˜³</span>
  } <span class="keyword">else</span> {
    node = <span class="number">1</span>  <span class="comment">// é˜´</span>
  }

  <span class="comment">// ç¬¬äºŒå±‚ï¼šå†…éƒ¨å› ç´  (äºŒçˆ»)</span>
  <span class="keyword">if</span> (å†…éƒ¨ä¼˜åŠ¿æ˜æ˜¾) {
    node = node | (<span class="number">0</span> << <span class="number">1</span>)
  } <span class="keyword">else</span> {
    node = node | (<span class="number">1</span> << <span class="number">1</span>)
  }

  <span class="comment">// ... ç»§ç»­6å±‚</span>

  <span class="comment">// å¶èŠ‚ç‚¹ï¼š64ç§é¢„å®šä¹‰ç­–ç•¥</span>
  <span class="keyword">return</span> STRATEGIES[node]
}

<span class="comment">// å¤æ‚åº¦: O(6) = O(1)</span>
<span class="comment">// æ ‘æ·±åº¦: 6</span>
<span class="comment">// å¶èŠ‚ç‚¹: 64</span>
          </div>
        </div>

        <div>
          <h3>ä¸ç°ä»£å†³ç­–æ ‘å¯¹æ¯”</h3>
          <table style="font-size:11px;">
            <tr>
              <th>ç‰¹æ€§</th>
              <th>æ˜“ç»</th>
              <th>CART/ID3</th>
            </tr>
            <tr>
              <td>æ ‘ç»“æ„</td>
              <td>å®Œç¾äºŒå‰æ ‘</td>
              <td>ä¸å¹³è¡¡æ ‘</td>
            </tr>
            <tr>
              <td>æ·±åº¦</td>
              <td>å›ºå®š6å±‚</td>
              <td>åŠ¨æ€ï¼ˆå¯èƒ½è¿‡æ‹Ÿåˆï¼‰</td>
            </tr>
            <tr>
              <td>åˆ†è£‚æ ‡å‡†</td>
              <td>é¢„å®šä¹‰ï¼ˆå…­çˆ»å«ä¹‰ï¼‰</td>
              <td>ä¿¡æ¯å¢ç›Š/åŸºå°¼</td>
            </tr>
            <tr>
              <td>å¶èŠ‚ç‚¹æ•°</td>
              <td>64ï¼ˆå®Œæ•´ï¼‰</td>
              <td>åŠ¨æ€å‰ªæ</td>
            </tr>
            <tr>
              <td>è§£é‡Šæ€§</td>
              <td>æ¯å±‚æœ‰è¯­ä¹‰</td>
              <td>ç»Ÿè®¡é©±åŠ¨</td>
            </tr>
          </table>

          <div class="insight">
            æ˜“ç»æ˜¯ä¸€ä¸ª<strong>æ‰‹å·¥è®¾è®¡çš„å®Œç¾äºŒå‰å†³ç­–æ ‘</strong>ï¼Œ
            ç‰¹ç‚¹æ˜¯ï¼šæ·±åº¦å›ºå®šã€è¯­ä¹‰æ˜ç¡®ã€æ— éœ€è®­ç»ƒã€å®Œå…¨å¯è§£é‡Šã€‚
          </div>
        </div>
      </div>
    </div>

    <!-- ä¿¡æ¯è®ºåˆ†æ -->
    <div class="card full">
      <h2>ğŸ“ ä¿¡æ¯è®ºåˆ†æ</h2>

      <div class="grid">
        <div>
          <h3>ä¿¡æ¯å®¹é‡</h3>
          <div class="metric" style="margin:10px 0;">
            <div class="value">6 bits</div>
            <div class="label">å•ä¸ªå¦è±¡ä¿¡æ¯é‡</div>
          </div>
          <div class="code" style="font-size:11px;">
<span class="comment">// ä¿¡æ¯ç†µè®¡ç®—</span>
H(å¦è±¡) = logâ‚‚(64) = <span class="number">6</span> bits

<span class="comment">// å¦‚æœå‡åŒ€åˆ†å¸ƒ</span>
æœ€å¤§ç†µ = <span class="number">6</span> bits

<span class="comment">// å®é™…ç­®å¦åˆ†å¸ƒï¼ˆéå‡åŒ€ï¼‰</span>
å®é™…ç†µ â‰ˆ <span class="number">5.7</span> bits
<span class="comment">// å› ä¸ºé˜´çˆ»æ¦‚ç‡ç•¥é«˜</span>
          </div>
        </div>

        <div>
          <h3>å‹ç¼©æ•ˆç‡</h3>
          <div class="metric" style="margin:10px 0;">
            <div class="value">448</div>
            <div class="label">å¦çˆ»è¾æ€»æ•°</div>
          </div>
          <div class="code" style="font-size:11px;">
<span class="comment">// çŸ¥è¯†å‹ç¼©æ¯”</span>
è¾“å…¥: 3000å¹´å†³ç­–ç»éªŒ
è¾“å‡º: 64å¦ Ã— 7è¾ = 448æ¡

<span class="comment">// å¹³å‡æ¯æ¡è¾è¦†ç›–</span>
~6.7å¹´ç»éªŒ / æ¡

<span class="comment">// è¿™æ˜¯æé«˜çš„çŸ¥è¯†å‹ç¼©ç‡</span>
          </div>
        </div>

        <div>
          <h3>å†—ä½™ä¸çº é”™</h3>
          <div class="metric" style="margin:10px 0;">
            <div class="value">5ç§</div>
            <div class="label">äº’å‚éªŒè¯æ–¹æ³•</div>
          </div>
          <div class="code" style="font-size:11px;">
<span class="comment">// å†—ä½™æ ¡éªŒæœºåˆ¶</span>
æœ¬å¦: ä¸»åˆ†æ
å˜å¦: è¶‹åŠ¿éªŒè¯
äº’å¦: å†…å› éªŒè¯
é”™å¦: åå‘éªŒè¯
ç»¼å¦: æ¢ä½éªŒè¯

<span class="comment">// 5é‡å†—ä½™ = å®¹é”™è®¾è®¡</span>
          </div>
        </div>
      </div>
    </div>

    <!-- å®é™…åº”ç”¨å»ºè®® -->
    <div class="card full">
      <h2>ğŸš€ ç»“è®ºï¼šå¦‚ä½•ç§‘å­¦åœ°ä½¿ç”¨è¿™ä¸ª"å¤ä»£å¤§æ•°æ®ç³»ç»Ÿ"</h2>

      <div class="grid">
        <div class="card" style="background: var(--surface2); border-color: var(--green);">
          <h3 style="color:var(--green);">âœ“ æœ‰æ•ˆç”¨æ³•</h3>
          <ul style="font-size:12px; margin-left:16px;">
            <li><strong>æƒ…å¢ƒåˆ†ç±»å™¨</strong>ï¼šå°†å¤æ‚é—®é¢˜å½’ç±»åˆ°64ç§æ¨¡å¼</li>
            <li><strong>æ£€æŸ¥æ¸…å•</strong>ï¼š6çˆ»=6ä¸ªå¿…æŸ¥ç»´åº¦</li>
            <li><strong>å¤šè§’åº¦åˆ†æ</strong>ï¼šæœ¬/å˜/äº’/é”™/ç»¼å¦</li>
            <li><strong>ç»éªŒå‚è€ƒ</strong>ï¼šå¦è¾ä½œä¸ºå†å²æ™ºæ…§</li>
            <li><strong>å¼ºåˆ¶å…¨é¢æ€è€ƒ</strong>ï¼šé¿å…å†³ç­–ç›²ç‚¹</li>
          </ul>
        </div>

        <div class="card" style="background: var(--surface2); border-color: var(--yellow);">
          <h3 style="color:var(--yellow);">âš  å±€é™æ€§</h3>
          <ul style="font-size:12px; margin-left:16px;">
            <li><strong>çŠ¶æ€ç©ºé—´æœ‰é™</strong>ï¼š64ç±»ä¸èƒ½è¦†ç›–æ‰€æœ‰æƒ…å†µ</li>
            <li><strong>äºŒå€¼åŒ–æŸå¤±</strong>ï¼šç°å®æ˜¯è¿ç»­çš„ï¼Œå¼ºåˆ¶0/1</li>
            <li><strong>å†å²åè§</strong>ï¼šåæ˜ å¤ä»£å†œä¸šç¤¾ä¼šä»·å€¼è§‚</li>
            <li><strong>æ— æ³•å­¦ä¹ </strong>ï¼šä¸èƒ½ä»æ–°æ•°æ®æ›´æ–°</li>
            <li><strong>æ¨¡ç³Šè¯­ä¹‰</strong>ï¼šå¦è¾éœ€è¦ä¸“ä¸šè§£è¯»</li>
          </ul>
        </div>

        <div class="card" style="background: var(--surface2); border-color: var(--cyan);">
          <h3 style="color:var(--cyan);">ğŸ“Š ç§‘å­¦å¯ä¿¡åº¦</h3>
          <div class="metric" style="margin-top:10px;">
            <div class="value">85%</div>
            <div class="label">ä½œä¸ºç»“æ„åŒ–åˆ†æå·¥å…·</div>
          </div>
          <p style="font-size:11px; color:var(--dim); margin-top:10px;">
            æ¯”ä¼ ç»Ÿç”¨æ³•(55%)æå‡30%<br>
            å¦‚å®Œå…¨å»é™¤"é¢„æµ‹"è‰²å½©ï¼Œå¯è¾¾95%
          </p>
        </div>
      </div>

      <div class="note" style="margin-top:16px;">
        <strong>æœ€ç»ˆç»“è®ºï¼š</strong>
        æ˜“ç»ä½œä¸ºä¸€ä¸ª"å¤ä»£å¤§æ•°æ®ç³»ç»Ÿ"ï¼Œå…¶æ ¸å¿ƒä»·å€¼ä¸åœ¨äºé¢„æµ‹ï¼Œè€Œåœ¨äºï¼š
        <br><br>
        1. <strong>é™ç»´</strong>ï¼šå°†å¤æ‚ç°å®å‹ç¼©åˆ°64ç§å¯å¤„ç†çš„æ¨¡å¼<br>
        2. <strong>ç»“æ„åŒ–</strong>ï¼šå¼ºåˆ¶ä»6ä¸ªç»´åº¦å…¨é¢åˆ†æ<br>
        3. <strong>ç»éªŒå¤ç”¨</strong>ï¼šè°ƒç”¨3000å¹´ç§¯ç´¯çš„å†³ç­–æ™ºæ…§<br>
        4. <strong>å¿ƒç†å‡†å¤‡</strong>ï¼šé€šè¿‡ä»ªå¼æ„Ÿå»ºç«‹å†³ç­–ä¿¡å¿ƒ<br><br>
        è¿™äº›åŠŸèƒ½åœ¨ç°ä»£å†³ç­–æ”¯æŒç³»ç»Ÿä¸­ä»ç„¶æœ‰æ•ˆï¼Œä¸”å®Œå…¨å¯ä»¥ç”¨ç§‘å­¦æ–¹æ³•å®ç°å’ŒéªŒè¯ã€‚
      </div>
    </div>
  </div>

<script>
// å…«å¦æ•°æ®
const TRIGRAMS = ['ä¹¾','å…‘','ç¦»','éœ‡','å·½','å','è‰®','å¤'];
const TRIGRAM_BITS = ['000','001','010','011','100','101','110','111'];

// ç”Ÿæˆè½¬ç§»æ¦‚ç‡çŸ©é˜µ
function generateTransitionMatrix() {
  const matrix = document.getElementById('transitionMatrix');
  let html = '<div class="cell header"></div>';

  // è¡¨å¤´
  TRIGRAMS.forEach(t => {
    html += `<div class="cell header">${t}</div>`;
  });

  // è¡¨ä½“
  for (let i = 0; i < 8; i++) {
    html += `<div class="cell header">${TRIGRAMS[i]}</div>`;
    for (let j = 0; j < 8; j++) {
      // è®¡ç®—æ±‰æ˜è·ç¦»
      const dist = hammingDistance(TRIGRAM_BITS[i], TRIGRAM_BITS[j]);
      let prob, cls;
      if (dist === 0) {
        prob = '0.25';
        cls = 'medium';
      } else if (dist === 1) {
        prob = '0.125';
        cls = 'high';
      } else if (dist === 2) {
        prob = '0';
        cls = 'low';
      } else {
        prob = '0';
        cls = 'low';
      }
      html += `<div class="cell ${cls}">${prob}</div>`;
    }
  }

  matrix.innerHTML = html;
}

function hammingDistance(a, b) {
  let dist = 0;
  for (let i = 0; i < a.length; i++) {
    if (a[i] !== b[i]) dist++;
  }
  return dist;
}

// é©¬å°”å¯å¤«æ¨¡æ‹Ÿ
function runMarkovSimulation() {
  const startSelect = document.getElementById('startState').value;
  const steps = parseInt(document.getElementById('simSteps').value);

  let state = startSelect === 'random' ? Math.floor(Math.random() * 64) : parseInt(startSelect);

  const output = document.getElementById('simOutput');
  const history = [state];
  const visitCount = new Array(64).fill(0);

  let html = `<div class="line"><span class="state">åˆå§‹çŠ¶æ€: ${stateToName(state)}</span></div>`;
  html += `<div class="line" style="color:var(--dim);">å¼€å§‹${steps}æ­¥æ¨¡æ‹Ÿ...</div>`;

  for (let i = 0; i < steps; i++) {
    // éšæœºé€‰æ‹©ä¸€ä¸ªçˆ»ä½å˜æ¢
    const changeBit = Math.floor(Math.random() * 6);
    const mask = 1 << changeBit;

    // ä»¥ä¸€å®šæ¦‚ç‡å˜æ¢ï¼ˆæ¨¡æ‹Ÿå˜çˆ»æ¦‚ç‡ï¼‰
    if (Math.random() < 0.4) {
      const newState = state ^ mask;
      if (i < 20 || i === steps - 1) {
        html += `<div class="line"><span class="arrow">æ­¥${i+1}:</span> <span class="state">${stateToName(state)}</span> <span class="arrow">â†’</span> <span class="state">${stateToName(newState)}</span> <span class="prob">(ç¬¬${changeBit+1}çˆ»å˜)</span></div>`;
      }
      state = newState;
    }

    history.push(state);
    visitCount[state]++;
  }

  if (steps > 20) {
    html += `<div class="line" style="color:var(--dim);">... çœç•¥ ${steps - 21} æ­¥ ...</div>`;
  }

  html += `<div class="line"><span class="state">æœ€ç»ˆçŠ¶æ€: ${stateToName(state)}</span></div>`;

  output.innerHTML = html;

  // æ›´æ–°ç»Ÿè®¡
  const uniqueVisited = visitCount.filter(c => c > 0).length;
  document.getElementById('metricVisited').textContent = uniqueVisited;

  // è®¡ç®—ç†µ
  const total = history.length;
  let entropy = 0;
  visitCount.forEach(c => {
    if (c > 0) {
      const p = c / total;
      entropy -= p * Math.log2(p);
    }
  });
  document.getElementById('metricEntropy').textContent = entropy.toFixed(2);

  // é˜³çˆ»ç‡
  let yangSum = 0;
  history.forEach(s => {
    yangSum += 6 - popcount(s);
  });
  const yangRatio = yangSum / (history.length * 6);
  document.getElementById('metricYangRatio').textContent = (yangRatio * 100).toFixed(1) + '%';

  // å‘¨æœŸæ£€æµ‹ï¼ˆç®€å•ï¼‰
  document.getElementById('metricCycles').textContent = detectCycle(history) || 'æ— ';

  // ç»˜åˆ¶åˆ†å¸ƒå›¾
  drawDistribution(visitCount);
}

function stateToName(state) {
  const binary = state.toString(2).padStart(6, '0');
  const upper = TRIGRAMS[parseInt(binary.substring(0, 3), 2)];
  const lower = TRIGRAMS[parseInt(binary.substring(3, 6), 2)];
  return `${upper}${lower}(${binary})`;
}

function popcount(n) {
  let count = 0;
  while (n) {
    count += n & 1;
    n >>= 1;
  }
  return count;
}

function detectCycle(history) {
  if (history.length < 10) return null;
  const last10 = history.slice(-10);
  for (let period = 2; period <= 4; period++) {
    let found = true;
    for (let i = 0; i < period; i++) {
      if (last10[last10.length - 1 - i] !== last10[last10.length - 1 - i - period]) {
        found = false;
        break;
      }
    }
    if (found) return `å‘¨æœŸ${period}`;
  }
  return null;
}

function drawDistribution(counts) {
  const canvas = document.getElementById('distributionChart');
  const ctx = canvas.getContext('2d');

  // è®¾ç½®ç”»å¸ƒå°ºå¯¸
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width * 2;
  canvas.height = rect.height * 2;
  ctx.scale(2, 2);

  const w = rect.width;
  const h = rect.height;

  // æ¸…ç©º
  ctx.fillStyle = '#0d1117';
  ctx.fillRect(0, 0, w, h);

  // æ‰¾æœ€å¤§å€¼
  const max = Math.max(...counts, 1);

  // ç»˜åˆ¶æŸ±çŠ¶å›¾
  const barWidth = w / 64 - 1;
  counts.forEach((c, i) => {
    const barHeight = (c / max) * (h - 20);
    const x = i * (w / 64);
    const y = h - barHeight - 10;

    // æ ¹æ®é˜³çˆ»æ•°é‡ç€è‰²
    const yangCount = 6 - popcount(i);
    const hue = (yangCount / 6) * 60 + 180; // è“åˆ°é’
    ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;
    ctx.fillRect(x, y, barWidth, barHeight);
  });

  // æ ‡ç­¾
  ctx.fillStyle = '#8b949e';
  ctx.font = '10px monospace';
  ctx.fillText('çŠ¶æ€åˆ†å¸ƒ (0-63)', 10, 12);
}

// é›†æˆæ¨¡æ‹Ÿ
function runEnsemble() {
  const output = document.getElementById('simOutput');
  output.innerHTML = '<div class="line" style="color:var(--dim);">è¿è¡Œ1000æ¬¡æ¨¡æ‹Ÿ...</div>';

  const finalStates = new Array(64).fill(0);
  const steps = 100;

  for (let run = 0; run < 1000; run++) {
    let state = Math.floor(Math.random() * 64);
    for (let i = 0; i < steps; i++) {
      if (Math.random() < 0.4) {
        const changeBit = Math.floor(Math.random() * 6);
        state = state ^ (1 << changeBit);
      }
    }
    finalStates[state]++;
  }

  // æ˜¾ç¤ºç»“æœ
  let html = '<div class="line" style="color:var(--cyan);">1000æ¬¡æ¨¡æ‹Ÿå®Œæˆ</div>';
  html += '<div class="line">æœ€å¸¸è§ç»ˆæ€:</div>';

  const sorted = finalStates.map((c, i) => ({state: i, count: c}))
    .sort((a, b) => b.count - a.count)
    .slice(0, 5);

  sorted.forEach(({state, count}) => {
    html += `<div class="line"><span class="state">${stateToName(state)}</span>: <span class="prob">${(count/10).toFixed(1)}%</span></div>`;
  });

  output.innerHTML = html;
  drawDistribution(finalStates);

  // æ›´æ–°æŒ‡æ ‡
  document.getElementById('metricVisited').textContent = finalStates.filter(c => c > 0).length;

  let entropy = 0;
  finalStates.forEach(c => {
    if (c > 0) {
      const p = c / 1000;
      entropy -= p * Math.log2(p);
    }
  });
  document.getElementById('metricEntropy').textContent = entropy.toFixed(2);
}

// ç¨³å®šæ€§åˆ†æ
function analyzeStability() {
  const output = document.getElementById('simOutput');

  let html = '<div class="line" style="color:var(--cyan);">ç¨³å®šæ€§åˆ†æ</div>';
  html += '<div class="line">å„å¦çš„ç¨³å®šæ€§ï¼ˆç•™åœ¨å½“å‰çŠ¶æ€çš„æ¦‚ç‡ï¼‰:</div>';

  // è®¡ç®—æ¯ä¸ªçŠ¶æ€çš„ç¨³å®šæ€§
  const stability = [];
  for (let i = 0; i < 64; i++) {
    const yangCount = 6 - popcount(i);
    // é˜³çˆ»å¤š=ç¨³å®šæ€§ä½ï¼ˆé˜³å˜æ¦‚ç‡é«˜ï¼‰
    // é˜´çˆ»å¤š=ç¨³å®šæ€§é«˜ï¼ˆé˜´å˜æ¦‚ç‡ä½ï¼‰
    const stab = 0.6 + 0.05 * (6 - yangCount);
    stability.push({state: i, stab});
  }

  stability.sort((a, b) => b.stab - a.stab);

  html += '<div class="line" style="color:var(--green);">æœ€ç¨³å®š:</div>';
  stability.slice(0, 3).forEach(({state, stab}) => {
    html += `<div class="line">  ${stateToName(state)}: ${(stab*100).toFixed(1)}%</div>`;
  });

  html += '<div class="line" style="color:var(--red);">æœ€ä¸ç¨³å®š:</div>';
  stability.slice(-3).reverse().forEach(({state, stab}) => {
    html += `<div class="line">  ${stateToName(state)}: ${(stab*100).toFixed(1)}%</div>`;
  });

  html += '<div class="line" style="margin-top:10px; color:var(--dim);">';
  html += 'å‘ç°: é˜´çˆ»å¤šçš„å¦æ›´ç¨³å®šï¼Œé˜³çˆ»å¤šçš„å¦æ›´æ˜“å˜ã€‚';
  html += '<br>è¿™ä¸ä¼ ç»Ÿè§£è¯»ä¸€è‡´ï¼šä¹¾ï¼ˆçº¯é˜³ï¼‰æ˜“äº¢ï¼Œå¤ï¼ˆçº¯é˜´ï¼‰å®ˆç¨³ã€‚';
  html += '</div>';

  output.innerHTML = html;
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
  generateTransitionMatrix();
});
</script>
</body>
</html>
