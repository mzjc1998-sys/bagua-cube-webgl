# 地牢肉鸽微信小游戏 - 游戏设计文档 (GDD)

## 📋 项目概述

### 游戏名称
**《玄牢志》** (暂定名)
- 副标题：八卦地牢 · 命运轮回

### 游戏类型
- **核心类型**: Roguelike / Roguelite
- **战斗系统**: 回合制卡牌 + 策略战斗
- **视角**: 俯视角 2D

### 平台目标
- 微信小游戏 (首发)
- 后续可扩展至其他小程序平台

### 设计理念
融合中国传统易学元素（八卦、五行、阴阳）与经典Roguelike机制，创造独特的东方地牢探索体验。

---

## 🎮 核心玩法

### 1. 游戏循环 (Core Loop)

```
┌─────────────────────────────────────────────────────────────┐
│                        主游戏循环                            │
├─────────────────────────────────────────────────────────────┤
│  选择角色 → 进入地牢 → 探索房间 → 战斗/事件 → 获取奖励      │
│      ↑                                              │       │
│      │         ← 死亡(永久死亡) ←──────────────────┘       │
│      │                                                       │
│      └───── Meta进度解锁 ←── 收集永久资源 ←───────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 2. 地牢结构

#### 层级设计
| 层级 | 名称 | 房间数 | 主题 | BOSS |
|------|------|--------|------|------|
| 1 | 土牢 | 8-10 | 入门教学 | 土行傀儡 |
| 2 | 水狱 | 10-12 | 水系机关 | 玄冥蛟龙 |
| 3 | 火窟 | 12-14 | 火焰陷阱 | 赤炎凤凰 |
| 4 | 金殿 | 14-16 | 机械怪物 | 金甲战神 |
| 5 | 木林 | 16-18 | 自然变异 | 青木妖藤 |
| 6 | 混沌界 | 20+ | 随机融合 | 太极阴阳兽 |

#### 房间类型
- **战斗房** (60%): 普通敌人遭遇战
- **精英房** (15%): 强敌 + 稀有奖励
- **宝藏房** (10%): 选择性奖励
- **事件房** (10%): 随机事件/商店/祭坛
- **BOSS房** (5%): 层级守关BOSS

### 3. 地图生成算法

```javascript
// 伪代码示意
function generateDungeonMap(level) {
  const roomCount = 8 + level * 2 + random(0, 4);
  const graph = new DungeonGraph();

  // 使用八卦方位生成房间布局
  const baguaPositions = ['乾','坤','震','巽','坎','离','艮','兑'];

  // 确保关键房间：入口、BOSS、商店
  graph.addRoom('entrance', {type: 'start'});
  graph.addRoom('boss', {type: 'boss'});

  // 填充中间房间
  for (let i = 0; i < roomCount - 2; i++) {
    const roomType = weightedRandom(ROOM_TYPE_WEIGHTS);
    graph.addRoom(`room_${i}`, {type: roomType});
  }

  // 生成路径（保证可达性）
  graph.generatePaths();

  return graph;
}
```

---

## ⚔️ 战斗系统

### 1. 回合制卡牌战斗

#### 基础机制
- **能量系统**: 每回合恢复3点能量，卡牌消耗能量
- **手牌**: 每回合抽5张牌
- **弃牌堆**: 回合结束未使用的牌进入弃牌堆
- **抽牌堆耗尽**: 弃牌堆洗入抽牌堆

#### 卡牌类型
| 类型 | 颜色 | 说明 | 示例 |
|------|------|------|------|
| 攻击 | 红色 | 造成伤害 | 横劈(6伤害,1能量) |
| 防御 | 蓝色 | 获得护甲 | 铁壁(8护甲,1能量) |
| 技能 | 绿色 | 特殊效果 | 聚气(+2能量,0能量) |
| 能力 | 紫色 | 永久增益 | 力量+1(持续到战斗结束) |
| 诅咒 | 黑色 | 负面效果 | 虚弱(无法使用,占用手牌) |

#### 五行相克系统
```
        木 ──克──→ 土
       ↗ ╲         ╲
      │   ╲         ↓
     生    ╲        金
      │     ╲      ↙ │
      ↓      ╲    ╱  生
     火 ←─克─ 水 ←┘   │
      │              ↓
      └──── 生 ─────→土

相克关系 (伤害+50%):
木克土、土克水、水克火、火克金、金克木

相生关系 (治疗+30%):
木生火、火生土、土生金、金生水、水生木
```

### 2. 角色属性

```javascript
const PlayerStats = {
  // 基础属性
  hp: 80,           // 生命值
  maxHp: 80,        // 最大生命值
  energy: 3,        // 每回合能量

  // 战斗属性
  strength: 0,      // 力量(增加攻击伤害)
  dexterity: 0,     // 敏捷(增加护甲值)

  // 五行亲和
  elements: {
    metal: 0,       // 金
    wood: 0,        // 木
    water: 0,       // 水
    fire: 0,        // 火
    earth: 0        // 土
  },

  // 八卦属性
  bagua: {
    qian: 0,  // 乾 - 天 - 创造力
    kun: 0,   // 坤 - 地 - 承载力
    zhen: 0,  // 震 - 雷 - 爆发力
    xun: 0,   // 巽 - 风 - 速度
    kan: 0,   // 坎 - 水 - 适应力
    li: 0,    // 离 - 火 - 攻击力
    gen: 0,   // 艮 - 山 - 防御力
    dui: 0    // 兑 - 泽 - 治愈力
  }
};
```

### 3. 敌人设计

#### 敌人AI行为模式
- **攻击型**: 优先攻击，少防御
- **防御型**: 交替攻防，高护甲
- **法术型**: 施放debuff，召唤小怪
- **BOSS型**: 多阶段，特殊机制

#### 敌人示例
```javascript
const enemies = {
  slime: {
    name: "五行黏液怪",
    hp: 25,
    element: "water",
    actions: [
      {type: "attack", damage: 6, weight: 60},
      {type: "buff", effect: "regen", weight: 40}
    ]
  },

  skeleton: {
    name: "骷髅战士",
    hp: 40,
    element: "metal",
    actions: [
      {type: "attack", damage: 10, weight: 50},
      {type: "defend", armor: 8, weight: 30},
      {type: "skill", effect: "bleed", weight: 20}
    ]
  },

  boss_earth_golem: {
    name: "土行傀儡",
    hp: 200,
    element: "earth",
    phases: [
      {threshold: 1.0, actions: ["slam", "defend"]},
      {threshold: 0.5, actions: ["quake", "summon", "defend"]},
      {threshold: 0.25, actions: ["berserk", "double_slam"]}
    ]
  }
};
```

---

## 🎭 角色系统

### 可选角色

| 角色 | 初始牌组 | 特殊能力 | 初始遗物 |
|------|----------|----------|----------|
| **剑客** | 攻击型 | 连击：连续出攻击牌伤害+1 | 青锋剑(攻击+2) |
| **道士** | 平衡型 | 五行：可改变卡牌属性 | 八卦镜(反伤10%) |
| **术士** | 技能型 | 诅咒：敌人随机获得诅咒 | 符咒袋(技能+1抽) |
| **武僧** | 防御型 | 禅定：未出牌回合获得护甲 | 念珠(回合末+3护甲) |

### 角色解锁条件
- **剑客**: 初始解锁
- **道士**: 首次通关第2层
- **术士**: 收集50种不同卡牌
- **武僧**: 累计获得1000护甲

---

## 🏆 进度系统

### 单局进度 (Run Progress)
- 获得的卡牌
- 收集的遗物
- 金币/资源
- 地图探索进度
- 当前属性/Buff

### 永久进度 (Meta Progress)

#### 解锁要素
```javascript
const metaUnlocks = {
  characters: ["剑客", "道士", "术士", "武僧"],

  cardPool: {
    common: [],     // 普通卡池
    uncommon: [],   // 稀有卡池
    rare: [],       // 史诗卡池
    legendary: []   // 传说卡池
  },

  relics: {
    starter: [],    // 初始遗物
    common: [],     // 普通遗物
    boss: []        // BOSS遗物
  },

  achievements: [
    {id: "first_win", name: "初出茅庐", desc: "首次通关"},
    {id: "no_damage", name: "毫发无伤", desc: "一场战斗不受伤害"},
    {id: "speed_run", name: "疾风迅雷", desc: "15分钟内通关"}
  ]
};
```

#### 永久货币
- **玄晶**: 通关/死亡获得，用于永久升级
- **八卦碎片**: 特殊成就获得，解锁隐藏内容

---

## 🎨 视觉设计

### 美术风格
- **整体风格**: 像素风 + 中国水墨元素
- **配色方案**: 以五行颜色为主
  - 金: #FFD700 (金黄)
  - 木: #228B22 (翠绿)
  - 水: #1E90FF (湛蓝)
  - 火: #FF4500 (赤红)
  - 土: #8B4513 (褐棕)

### UI布局 (战斗界面)
```
┌────────────────────────────────────────────────────────────┐
│ [HP: ██████████ 80/80]    [层级: 1-3]    [金币: 150]      │
├────────────────────────────────────────────────────────────┤
│                                                            │
│                     ┌─────────┐                           │
│                     │  敌 人  │                           │
│                     │ HP: 40  │                           │
│                     │ 意图:🗡️ │                           │
│                     └─────────┘                           │
│                                                            │
│                     ┌─────────┐                           │
│                     │  玩 家  │                           │
│                     │ 护甲: 5 │                           │
│                     └─────────┘                           │
│                                                            │
├────────────────────────────────────────────────────────────┤
│  能量: ⚡⚡⚡                抽牌堆: 15  弃牌堆: 8        │
├────────────────────────────────────────────────────────────┤
│ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐             │
│ │ 横劈 │ │ 铁壁 │ │ 聚气 │ │ 火球 │ │ 疾风 │             │
│ │ ⚡1  │ │ ⚡1  │ │ ⚡0  │ │ ⚡2  │ │ ⚡1  │             │
│ │ 🗡️6  │ │ 🛡️8  │ │ +2⚡ │ │ 🔥12 │ │ 🗡️4x2│             │
│ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘             │
├────────────────────────────────────────────────────────────┤
│                    [结束回合]                              │
└────────────────────────────────────────────────────────────┘
```

### 地图界面
```
┌────────────────────────────────────────────────────────────┐
│                      第一层 - 土牢                         │
├────────────────────────────────────────────────────────────┤
│                                                            │
│                          [👹 BOSS]                        │
│                              │                             │
│                    ┌─────────┼─────────┐                  │
│                    │         │         │                  │
│                 [💀 精英]  [⚔️ 战斗]  [❓ 事件]           │
│                    │         │         │                  │
│              ┌─────┴───┐  ┌──┴──┐  ┌───┴────┐            │
│              │         │  │     │  │        │            │
│           [⚔️]      [💰]  [⚔️]  [⚔️]      [🏪]            │
│              │         │  │     │         │              │
│              └────┬────┴──┴──┬──┴─────────┘              │
│                   │          │                            │
│                [🚪 入口] ← 你在这里                       │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## 🔊 音效设计

### 音效列表
| 场景 | 音效类型 | 说明 |
|------|----------|------|
| 战斗 | BGM | 紧张的战斗音乐 |
| 探索 | BGM | 神秘的地牢氛围 |
| BOSS | BGM | 史诗级BOSS战音乐 |
| 攻击 | SFX | 刀剑/法术音效 |
| 受伤 | SFX | 角色受伤音效 |
| 抽牌 | SFX | 卡牌翻动音效 |
| 升级 | SFX | 成就/升级提示音 |

---

## 💰 商业模式

### 核心原则
- **公平游戏**: 不卖数值，不卖体力
- **尊重玩家**: 无强制广告

### 收入来源

#### 1. 激励视频广告
- 死亡复活 (每局限1次)
- 双倍奖励 (战斗结束可选)
- 免费刷新商店

#### 2. 皮肤系统
- 角色皮肤
- 卡背皮肤
- 特效皮肤

#### 3. 通行证 (可选)
- 免费轨道: 基础奖励
- 付费轨道: 额外皮肤+玄晶

---

## 📱 微信小游戏适配

### 技术要求
- **包体大小**: 主包 < 4MB，分包总计 < 20MB
- **内存控制**: < 1GB
- **启动速度**: 首次 < 5s，二次 < 2s

### 社交功能
- 好友排行榜
- 分享卡片 (分享得奖励)
- 好友助力 (每日限次)

### 存档同步
- 微信云存档
- 本地缓存备份
- 多设备同步

---

## 🛠️ 技术架构

### 推荐引擎
**Cocos Creator 3.x** (推荐)
- 微信小游戏适配成熟
- TypeScript支持
- 2D渲染性能优秀
- 中文文档完善

### 备选方案
- **Phaser 3**: 轻量级，学习曲线低
- **PixiJS + 自研**: 极致性能控制
- **Laya**: 国产引擎，小游戏优化好

### 项目结构 (Cocos Creator)
```
project/
├── assets/
│   ├── scripts/
│   │   ├── core/           # 核心系统
│   │   │   ├── GameManager.ts
│   │   │   ├── BattleSystem.ts
│   │   │   ├── CardSystem.ts
│   │   │   └── DungeonGenerator.ts
│   │   ├── entities/       # 实体类
│   │   │   ├── Player.ts
│   │   │   ├── Enemy.ts
│   │   │   └── Card.ts
│   │   ├── ui/             # UI组件
│   │   │   ├── BattleUI.ts
│   │   │   ├── MapUI.ts
│   │   │   └── CardUI.ts
│   │   └── data/           # 数据配置
│   │       ├── CardsData.ts
│   │       ├── EnemiesData.ts
│   │       └── RelicsData.ts
│   ├── prefabs/            # 预制体
│   ├── textures/           # 图片资源
│   ├── audio/              # 音频资源
│   └── scenes/             # 场景
├── build/                  # 构建输出
└── settings/               # 项目设置
```

---

## 📅 开发路线图

### 阶段1: 原型验证 (2-3周)
- [ ] 基础战斗系统
- [ ] 核心卡牌机制
- [ ] 简单敌人AI
- [ ] 单层地牢

### 阶段2: 核心玩法 (4-6周)
- [ ] 完整6层地牢
- [ ] 4个可玩角色
- [ ] 50+卡牌
- [ ] 20+敌人类型
- [ ] 遗物系统

### 阶段3: 内容扩充 (4-6周)
- [ ] 100+卡牌
- [ ] 50+遗物
- [ ] 事件系统
- [ ] Meta进度
- [ ] 成就系统

### 阶段4: 打磨上线 (2-4周)
- [ ] UI美化
- [ ] 音效完善
- [ ] 平衡性调整
- [ ] 微信适配
- [ ] 性能优化

### 阶段5: 运营迭代 (持续)
- [ ] 每月新内容
- [ ] 玩家反馈
- [ ] 活动系统
- [ ] 社交功能

---

## 📝 核心设计原则

1. **易上手，难精通**: 规则简单，策略深度
2. **每局不同**: 高随机性保证重玩价值
3. **死亡有意义**: 永久进度缓解挫败感
4. **尊重时间**: 单局15-30分钟
5. **文化特色**: 融入中国传统元素

---

## 🎯 成功指标 (KPIs)

| 指标 | 目标值 |
|------|--------|
| 次日留存 | > 40% |
| 7日留存 | > 20% |
| 平均游戏时长 | > 15分钟/次 |
| 月活跃用户 | 10万+ |
| 付费转化率 | > 3% |
| ARPU | > ¥5 |

---

*文档版本: v1.0*
*最后更新: 2024*
*作者: Claude AI Assistant*
